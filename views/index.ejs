<%- include('partials/header', { pageTitle: 'All Posts' }) %>
    <h1 class="text-2xl font-semibold mb-4 text-slate-900">All Posts</h1>
    <form action="/posts" method="get" class="mb-4">
        <div class="flex flex-wrap gap-2">
            <input type="text" name="q" value="<%= typeof q !== 'undefined' ? q : '' %>" placeholder="Search posts..." class="flex-1 min-w-[240px] rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-400" />
            <select name="sort" class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-400">
                <option value="latest" <%= sort === 'latest' ? 'selected' : '' %>>Latest</option>
                <option value="likes" <%= sort === 'likes' ? 'selected' : '' %>>Most liked</option>
                <option value="trending" <%= sort === 'trending' ? 'selected' : '' %>>Trending</option>
            </select>
            <input type="text" name="tag" value="<%= typeof tag !== 'undefined' ? tag : '' %>" placeholder="Tag (exact)" class="rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-400" />
            <button class="px-4 py-2 rounded-md bg-red-700 text-white hover:bg-red-600">Apply</button>
        </div>
    </form>
    <div class="space-y-4">
    <% if (!posts || posts.length === 0) { %>
        <div class="rounded-md border border-slate-200 bg-white p-6 text-slate-600">
            No posts found. Try a different search.
        </div>
    <% } %>
    <% for (post of posts) { %>
        <article class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm">
            <header class="flex items-start justify-between gap-4">
                <div>
                    <h3 class="text-sm text-slate-500 font-semibold">@<%= post.username %></h3>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button data-like-btn data-post-id="<%= post.id %>" class="inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50">‚ù§ Like (<span data-like-count="<%= post.id %>"><%= post.likes || 0 %></span>)</button>
                    <a href="/posts/<%= post.id %>" class="inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50">View</a>
                    <a href="/posts/<%= post.id %>/edit" class="inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md bg-red-700 text-white hover:bg-red-600">Edit</a>
                    <form method="post" action="/posts/<%= post.id %>?_method=DELETE">
                        <button data-delete-btn class="inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-red-300 text-red-600 hover:bg-red-50">Delete</button>
                    </form>
                </div>
            </header>
            <p class="mt-3 text-slate-800"><%= post.content %></p>
            <% if (post.tags && post.tags.length) { %>
                <div class="mt-3 flex flex-wrap gap-2">
                    <% post.tags.forEach(function(t){ %>
                        <a href="/posts?tag=<%= encodeURIComponent(t) %>" class="inline-flex items-center px-2 py-0.5 text-xs rounded-full bg-red-50 text-red-700 border border-red-200">#<%= t %></a>
                    <% }); %>
                </div>
            <% } %>
        </article>
    <% } %>
    </div>
<%- include('partials/footer') %>